"use strict";!function(){var e,t=ax5.ui,o=ax5.util;t.addClass({className:"autocomplete",version:"0.0.1"},function(){var t=function(){var t,i=this;this.instanceId=ax5.getGuid(),this.config={theme:"default",animateTime:250,removeIcon:"X",lang:{noSelected:"",noOptions:"no options",loading:"now loading.."},columnKeys:{optionValue:"value",optionText:"text",optionSelected:"selected"}},this.queue=[],this.activecomboboxOptionGroup=null,this.activecomboboxQueueIndex=-1,this.openTimer=null,this.closeTimer=null,this.waitOptionsCallback=null,this.keyUpTimer=null,t=this.config;var n=function(e,t){return e&&e.onStateChanged?e.onStateChanged.call(t,t):this.onStateChanged&&this.onStateChanged.call(t,t),"changeValue"==t.state&&(e&&e.onChange?e.onChange.call(t,t):this.onChange&&this.onChange.call(t,t)),e=null,t=null,!0},a=function(){for(var e,t=this.queue.length;t--;){var i=this.queue[t];if(i.$display&&(e=Math.max(i.$select.outerWidth(),o.number(i.minWidth)),i.$display.css({"min-width":e}),i.reset&&i.$display.find(".addon-icon-reset").css({"line-height":this.queue[t].$display.height()+"px"}),i.multiple)){var n=function(){return o.number(i.$display.css("border-top-width"))+o.number(i.$display.css("border-bottom-width"))}.call(this);i.$target.height(""),i.$display.height("");var a=i.$displayTable.outerHeight();Math.abs(a-i.$target.height())>n&&(i.$target.css({height:a+n}),i.$display.css({height:a+n}))}}return t=null,e=null,this},s=function(e){if(!this.activecomboboxOptionGroup)return this;var t=this.queue[this.activecomboboxQueueIndex],o={},i={};e&&jQuery(document.body).append(this.activecomboboxOptionGroup),o=t.$target.offset(),i={width:t.$target.outerWidth(),height:t.$target.outerHeight()},t.direction&&""!==t.direction&&"auto"!==t.direction||(t.direction="top"),e&&this.activecomboboxOptionGroup.addClass("direction-"+t.direction),this.activecomboboxOptionGroup.css(function(){return"top"==t.direction?{left:o.left,top:o.top+i.height+1,width:i.width}:"bottom"==t.direction?{left:o.left,top:o.top-this.activecomboboxOptionGroup.outerHeight()-1,width:i.width}:void 0}.call(this))},l=function(e,t){if(!this.activecomboboxOptionGroup)return this;var i=this.queue[this.activecomboboxQueueIndex],n="display";return(t=o.findParentNode(e.target,function(e){return e.getAttribute("data-option-value")?(n="optionItem",!0):i.$target.get(0)==e?(n="display",!0):void 0}))?("optionItem"===n&&($.call(this,i.id,{index:{gindex:t.getAttribute("data-option-group-index"),index:t.getAttribute("data-option-index")}},void 0,"internal"),o.selectRange(i.$displayLabel,"end"),i.multiple||this.close()),this):(this.close(),this)},u=function(t){if(t.keyCode==ax5.info.eventKeys.ESC)this.close();else if(t.which==ax5.info.eventKeys.RETURN){for(var o=[],i=this.queue[this.activecomboboxQueueIndex],n=i.$displayLabel.get(0).childNodes,a=0,s=n.length;s>a;a++){var l=n[a];if(l.nodeType in e.util.nodeTypeProcessor){var u=e.util.nodeTypeProcessor[l.nodeType].call(this,this.activecomboboxQueueIndex,l);"undefined"!=typeof u&&o.push(u)}}$.call(this,i.id,o,!0),p.call(this,this.activecomboboxQueueIndex),i.multiple||this.close()}},c=function(t){var o=this.queue[t],i={};return i.id=o.id,i.theme=o.theme,i.size="ax5autocomplete-option-group-"+o.size,i.multiple=o.multiple,i.lang=o.lang,i.options=o.options,i.selected=o.selected,i.hasSelected=i.selected&&i.selected.length>0,i.removeIcon=o.removeIcon,ax5.mustache.render(e.tmpl.label.call(this,o.columnKeys),i)+"&nbsp;"},d=function(e){var t,i=this.queue[e];if(i.$displayLabel.html(c.call(this,e)),i.$target.height(""),i.$display.height(""),i.$target.height()<(t=i.$displayTable.outerHeight())){var n=function(){return o.number(i.$display.css("border-top-width"))+o.number(i.$display.css("border-bottom-width"))}();i.$target.css({height:t+n}),i.$display.css({height:t+n})}},p=function(e){this.queue[e].$displayLabel.trigger("focus"),o.selectRange(this.queue[e].$displayLabel,"end")},r=function(e){this.queue[e].$displayLabel.trigger("blur")},h=function(e,t){this.queue[e].waitOptions=!0,this.activecomboboxOptionGroup.find('[data-els="content"]').html(jQuery(ax5.mustache.render(getOptionsTmpl.call(this,this.queue[e].columnKeys),this.queue[e]))),this.queue[e].onSearch.call({self:this,item:this.queue[e],searchWord:t},function(e){var t={},i=this.queue[this.activecomboboxQueueIndex];return i?(function(e,t){var i={};t.options.forEach(function(t,o){t["@index"]=o,i[t[e.columnKeys.optionValue]]=t}),o.isArray(e.selected)&&e.selected.forEach(function(o){i[o[e.columnKeys.optionValue]]&&(t.options[i[o[e.columnKeys.optionValue]]["@index"]][e.columnKeys.optionSelected]=!0)})}(i,e),i.options=f.call(this,this.activecomboboxQueueIndex,e.options),a.call(this),t.id=i.id,t.theme=i.theme,t.size="ax5autocomplete-option-group-"+i.size,t.multiple=i.multiple,t.lang=i.lang,t.options=i.options,void this.activecomboboxOptionGroup.find('[data-els="content"]').html(jQuery(ax5.mustache.render(getOptionsTmpl.call(this,i.columnKeys),t)))):!1}.bind(this))},x=function(e,t){if(-1==this.activecomboboxQueueIndex)return this;var o,i=[],n=-1,a=this.queue[e].indexedOptions.length-1;if(""!=t){var s=/[\{\}\[\]\/?.,;:|\)*~`!^\-_+<>@\#$%&\\\=\(\'\"]/gi;if(t=t.replace(s,""),this.queue[e].onSearch){h.call(this,e,t);try{return i}finally{i=null,n=null,a=null,o=null}}for(;a-n++;){if(o=this.queue[e].indexedOptions[n],(""+o.text).toLowerCase()==t.toLowerCase()){i=[{"@findex":o["@findex"],optionsSort:0}];break}var l=(""+o.text).toLowerCase().search(t.toLowerCase());if(l>-1&&(i.push({"@findex":o["@findex"],optionsSort:l}),i.length>2))break;l=null}i.sort(function(e,t){return e.optionsSort-t.optionsSort})}i&&i.length>0?b.call(this,e,void 0,i[0]["@findex"]):m.call(this,e);try{return i}finally{i=null,n=null,a=null,o=null}},m=function(e){this.activecomboboxOptionGroup&&this.activecomboboxOptionGroup.find("[data-option-focus-index]").removeClass("hover").removeAttr("data-option-selected"),this.queue[e].optionFocusIndex=-1},b=function(e,t,i){var n,a,s,l,u=this.queue[e];if(this.activecomboboxOptionGroup&&u.options&&u.options.length>0){if("undefined"!=typeof i?n=i:(a=-1==u.optionFocusIndex?u.optionSelectedIndex||-1:u.optionFocusIndex,-1==a?n=0:(n=a+t,0>n?n=0:n>u.optionItemLength-1&&(n=u.optionItemLength-1))),u.optionFocusIndex=n,u.options[n]&&u.options[n].hide){if("undefined"==typeof t)return this;for(;u.options[n].hide;){if(n+=t,0>n){n=0;break}if(n>u.optionItemLength-1){n=u.optionItemLength-1;break}}}if("undefined"!=typeof n&&(this.activecomboboxOptionGroup.find("[data-option-focus-index]").removeClass("hover"),s=this.activecomboboxOptionGroup.find('[data-option-focus-index="'+n+'"]').addClass("hover"),l=this.activecomboboxOptionGroup.find('[data-els="content"]'),s.get(0))){var c=s.outerHeight(),d=l.innerHeight(),p=l.scrollTop(),r=s.position().top+l.scrollTop();if(r+c>d+p?l.scrollTop(r+c-d):p>r&&l.scrollTop(r),"undefined"!=typeof t){var h=u.$displayLabel.get(0).childNodes,x=h[h.length-1];x&&"3"==x.nodeType?(x.nodeValue=u.indexedOptions[n].text,o.selectRange(u.$displayLabel,"end")):x&&"1"==x.nodeType&&(jQuery(x).after(u.indexedOptions[n].text),o.selectRange(u.$displayLabel,"end"))}}}},f=function(){var e=function(e,t){t?this.queue[e].selected.push(jQuery.extend({},t)):this.queue[e].selected=[]};return function(t,n){var a,s,l,u=this.queue[t],c=0;return e.call(this,t,!1),n?(u.options=n,u.indexedOptions=[],a=[],a.push('<option value=""></option>'),u.options.forEach(function(o,n){o.optgroup?(o["@gindex"]=n,o.options.forEach(function(o,s){o["@index"]=s,o["@findex"]=c,a.push('<option value="'+o[u.columnKeys.optionValue]+'" '+(o[u.columnKeys.optionSelected]?' selected="selected"':"")+">"+o[u.columnKeys.optionText]+"</option>"),o[u.columnKeys.optionSelected]&&e.call(i,t,o),u.indexedOptions.push({"@gindex":n,"@index":s,"@findex":c,value:o[u.columnKeys.optionValue],text:o[u.columnKeys.optionText]}),c++})):(o["@index"]=n,o["@findex"]=c,a.push('<option value="'+o[u.columnKeys.optionValue]+'" '+(o[u.columnKeys.optionSelected]?' selected="selected"':"")+">"+o[u.columnKeys.optionText]+"</option>"),o[u.columnKeys.optionSelected]&&e.call(i,t,o),u.indexedOptions.push({"@index":n,"@findex":c,value:o[u.columnKeys.optionValue],text:o[u.columnKeys.optionText]}),c++)}),u.optionItemLength=c,u.$select.html(a.join(""))):(u.$select.get(0).options&&u.$select.get(0).options.length&&(u.$select.get(0).options[0].selected=!1),s=o.toArray(u.$select.get(0).options),l=[],s.forEach(function(o,n){var a={};a[u.columnKeys.optionValue]=o.value,a[u.columnKeys.optionText]=o.text,a[u.columnKeys.optionSelected]=o.selected,a["@index"]=n,a["@findex"]=c,o.selected&&e.call(i,t,a),l.push(a),c++,a=null}),u.options=l,u.indexedOptions=l,u.$select.prepend('<option value=""></option>'),u.$select.get(0).options[0].selected=!0),a=null,s=null,l=null,u.options}}(),v=function(e){return e instanceof jQuery?e=e.data("data-ax5autocomplete-id"):o.isString(e)||(e=jQuery(e).data("data-ax5autocomplete-id")),o.isString(e)?o.search(this.queue,function(){return this.id==e}):void console.log(ax5.info.getError("ax5autocomplete","402","getQueIdx"))},g=function(e,t,o){return"undefined"==typeof o?e.multiple?!t:!0:o},y=function(e){this.queue[e].options.forEach(function(e){e.optgroup?e.options.forEach(function(e){e.selected=!1}):e.selected=!1})},$=function(){var e={index:function(e,t,n,a){var l=this.queue[e];o.isString(t.index.gindex)?"undefined"!=typeof l.options[t.index.gindex]&&(l.options[t.index.gindex].options[t.index.index][l.columnKeys.optionSelected]=g(l,l.options[t.index.gindex].options[t.index.index][l.columnKeys.optionSelected],n),i.activecomboboxOptionGroup&&i.activecomboboxOptionGroup.find('[data-option-group-index="'+t.index.gindex+'"][data-option-index="'+t.index.index+'"]').attr("data-option-Selected",l.options[t.index.gindex].options[t.index.index][l.columnKeys.optionSelected].toString())):"undefined"!=typeof l.options[t.index.index]&&(l.options[t.index.index][l.columnKeys.optionSelected]=g(l,l.options[t.index.index][l.columnKeys.optionSelected],n),i.activecomboboxOptionGroup&&i.activecomboboxOptionGroup.find('[data-option-index="'+t.index.index+'"]').attr("data-option-Selected",l.options[t.index.index][l.columnKeys.optionSelected].toString())),("undefined"==typeof a||"justSetValue"!==a)&&(f.call(this,e,l.options),d.call(this,e),s.call(this))},arr:function(t,n,a,l){n.forEach(function(n){if(o.isString(n)||o.isNumber(n))e.text.call(i,t,n,a,"justSetValue");else for(var s in e)if(n[s]){e[s].call(i,t,n,a,"justSetValue");break}}),f.call(this,t,this.queue[t].options),d.call(this,t),s.call(this)},value:function(e,t,i,n){var a,l=this.queue[e],u=o.search(l.options,function(){return this[l.columnKeys.optionValue]==t[l.columnKeys.optionValue]});u>-1?l.options[u][l.columnKeys.optionSelected]=g(l,l.options[u][l.columnKeys.optionSelected],i):(u=l.options.length,a={"@index":u,hide:!0,addedOption:!0},a[l.columnKeys.optionValue]=t,a[l.columnKeys.optionText]=t,l.options.push(a),l.options[u][l.columnKeys.optionSelected]=g(l,l.options[u][l.columnKeys.optionSelected],i)),("undefined"==typeof n||"justSetValue"!==n)&&(f.call(this,e,this.queue[e].options),d.call(this,e),s.call(this))},text:function(e,t,i,n){var a,l=this.queue[e],u=o.search(l.options,function(){return this[l.columnKeys.optionText]==t});u>-1?l.options[u][l.columnKeys.optionSelected]=g(l,l.options[u][l.columnKeys.optionSelected],i):(u=l.options.length,a={"@index":u,hide:!0,addedOption:!0},a[l.columnKeys.optionValue]=t,a[l.columnKeys.optionText]=t,l.options.push(a),l.options[u][l.columnKeys.optionSelected]=g(l,l.options[u][l.columnKeys.optionSelected],i)),("undefined"==typeof n||"justSetValue"!==n)&&(f.call(this,e,this.queue[e].options),d.call(this,e),s.call(this))},clear:function(e){y.call(this,e),f.call(this,e,this.queue[e].options),p.call(this,e),m.call(this,e),this.activecomboboxOptionGroup&&this.activecomboboxOptionGroup.find("[data-option-index]").attr("data-option-Selected","false"),this.queue[e].optionSelectedIndex=-1}};return function(t,i,a,s){var l=o.isNumber(t)?t:v.call(this,t);if(-1===l)return void console.log(ax5.info.getError("ax5autocomplete","402","val"));if("undefined"==typeof i)throw"error not found value";if(o.isArray(i))e.clear.call(this,l),e.arr.call(this,l,this.queue[l].multiple||0==i.length?i:[i[i.length-1]],a);else if(o.isString(i)||o.isNumber(i))"undefined"==typeof i||null===i||this.queue[l].multiple||y.call(this,l),e.text.call(this,l,i,a),d.call(this,l);else if(null===i)e.clear.call(this,l),d.call(this,l);else{this.queue[l].multiple||y.call(this,l);for(var u in e)if(i[u]){e[u].call(this,l,i,a);break}d.call(this,l)}return"undefined"!=typeof i&&s&&!s.noStateChange&&n.call(this,this.queue[l],{self:this,item:this.queue[l],state:"changeValue",value:this.queue[l].selected}),t=null,this}}();this.init=function(){this.onStateChanged=t.onStateChanged,this.onChange=t.onChange,jQuery(window).bind("resize.ax5autocomplete-display-"+this.instanceId,function(){a.call(this)}.bind(this))},this.bind=function(n){var s,l=function(){var t=o.debounce(function(t){if(-1==this.activecomboboxQueueIndex)return this;for(var n=[],a="",s=this.queue[t],l=s.$displayLabel.get(0).childNodes,u=0,c=l.length;c>u;u++){var d=l[u];if(d.nodeType in e.util.nodeTypeProcessor){var p=e.util.nodeTypeProcessor[d.nodeType].call(this,this.activecomboboxQueueIndex,d,!0);"undefined"==typeof p||(o.isString(p)?(a=p,"1"==d.nodeType&&d.getAttribute("data-ax5autocomplete-selected-text")?a=!1:n.push(p)):n.push(p))}}0==l.length?$.call(this,s.id,null,void 0,"internal"):a===!1?($.call(this,s.id,null,void 0,"internal"),$.call(this,s.id,n,void 0,"internal"),o.selectRange(s.$displayLabel,"end")):""!=a&&x.call(i,t,a)},150),n=function(t){for(var i,n=[],a=this.queue[t],s=a.$displayLabel.get(0).childNodes,l=0,u=s.length;u>l;l++){var c=s[l];if(c.nodeType in e.util.nodeTypeProcessor){var d=e.util.nodeTypeProcessor[c.nodeType].call(this,t,c,!0);"undefined"==typeof d||(o.isString(d)?(i=d,n.push(d)):n.push(d))}}"undefined"!=typeof i&&$.call(this,a.id,n,void 0,"internal")},s={click:function(e,t){var n,a=o.findParentNode(t.target,function(e){return e.getAttribute("data-ax5autocomplete-remove")?(n="optionItemRemove",!0):e.getAttribute("data-selected-clear")?(n="clear",!0):void 0});if(a){if("optionItemRemove"===n){var s=a.getAttribute("data-ax5autocomplete-remove-index"),l=this.queue[e].selected[s];return $.call(this,e,{index:{gindex:l["@gindex"],index:l["@index"]}},!1,!0),p.call(this,e),o.stopEvent(t),this}"clear"===n&&$.call(this,e,{clear:!0})}else i.activecomboboxQueueIndex==e?-1==this.queue[e].optionFocusIndex&&i.close():(i.open(e),""==this.queue[e].$displayLabel.text().replace(/^\W*|\W*$/g,"")&&(this.queue[e].$displayLabel.html(c.call(this,e)),p.call(this,e)))},keyUp:function(e,n){return n.which==ax5.info.eventKeys.ESC&&-1===i.activecomboboxQueueIndex?(o.stopEvent(n),this):(i.activecomboboxQueueIndex!=e&&(i.open(e),o.stopEvent(n)),void t.call(this,e))},keyDown:function(e,t){t.which==ax5.info.eventKeys.ESC?o.stopEvent(t):t.which==ax5.info.eventKeys.RETURN?o.stopEvent(t):t.which==ax5.info.eventKeys.DOWN?(b.call(this,e,1),o.stopEvent(t)):t.which==ax5.info.eventKeys.UP&&(b.call(this,e,-1),o.stopEvent(t))},focus:function(e,t){},blur:function(e,t){n.call(this,e),o.stopEvent(t)},selectChange:function(e,t){$.call(this,e,{value:this.queue[e].$select.val()},!0)}};return function(t){var o=this.queue[t],i={};return o.selected=[],o.$display?(o.$displayLabel.html(c.call(this,t)),o.options=f.call(this,t,o.options),a.call(this)):(i.instanceId=this.instanceId,i.id=o.id,i.name=o.name,i.theme=o.theme,i.tabIndex=o.tabIndex,i.multiple=o.multiple,i.reset=o.reset,i.label=c.call(this,t),i.formSize=function(){return o.size?"input-"+o.size:""}(),o.$display=jQuery(ax5.mustache.render(e.tmpl.autocompleteDisplay.call(this,t),i)),o.$displayTable=o.$display.find('[data-els="display-table"]'),o.$displayLabel=o.$display.find('[data-ax5autocomplete-display="label"]'),o.$target.find("select").get(0)?(o.$select=o.$target.find("select"),o.$select.attr("tabindex","-1").attr("class","form-control "+i.formSize),i.name&&o.$select.attr("name","name"),i.multiple&&o.$select.attr("multiple","multiple")):(o.$select=jQuery(ax5.mustache.render(e.tmpl.formSelect.call(this,t),i)),o.$target.append(o.$select)),o.$target.append(o.$display),o.options=f.call(this,t,o.options),a.call(this)),o.$display.unbind("click.ax5autocomplete").bind("click.ax5autocomplete",s.click.bind(this,t)),o.$displayLabel.unbind("focus.ax5autocomplete").bind("focus.ax5autocomplete",s.focus.bind(this,t)).unbind("blur.ax5autocomplete").bind("blur.ax5autocomplete",s.blur.bind(this,t)).unbind("keyup.ax5autocomplete").bind("keyup.ax5autocomplete",s.keyUp.bind(this,t)).unbind("keydown.ax5autocomplete").bind("keydown.ax5autocomplete",s.keyDown.bind(this,t)),o.$select.unbind("change.ax5autocomplete").bind("change.ax5autocomplete",s.selectChange.bind(this,t)),i=null,o=null,t=null,this}}(),u={};return n=jQuery.extend(!0,u,t,n),n.target?(n.$target=jQuery(n.target),n.id||(n.id=n.$target.data("data-ax5autocomplete-id")),n.id||(n.id="ax5autocomplete-"+ax5.getGuid(),n.$target.data("data-ax5autocomplete-id",n.id)),n.name=n.$target.attr("data-ax5autocomplete"),n.options&&(n.options=JSON.parse(JSON.stringify(n.options))),function(e){o.isObject(e)&&!e.error&&(n=jQuery.extend(!0,n,e))}(o.parseJson(n.$target.attr("data-ax5autocomplete-config"),!0)),s=o.search(this.queue,function(){return this.id==n.id}),-1===s?(this.queue.push(n),l.call(this,this.queue.length-1)):(this.queue[s]=jQuery.extend(!0,{},this.queue[s],n),l.call(this,s)),u=null,s=null,this):(console.log(ax5.info.getError("ax5autocomplete","401","bind")),this)},this.open=function(){var i=function(t){t.onExpand.call({self:this,item:t},function(t){if(this.waitOptionsCallback){var i={},n=this.queue[this.activecomboboxQueueIndex];!function(e,t){var i={};t.options.forEach(function(t,o){t["@index"]=o,i[t[e.columnKeys.optionValue]]=t}),o.isArray(e.selected)&&e.selected.forEach(function(o){i[o[e.columnKeys.optionValue]]&&(t.options[i[o[e.columnKeys.optionValue]]["@index"]][e.columnKeys.optionSelected]=!0)})}(n,t),n.$display.find('[data-ax5autocomplete-display="label"]').html(c.call(this,this.activecomboboxQueueIndex)),n.options=f.call(this,this.activecomboboxQueueIndex,t.options),a.call(this),i.id=n.id,i.theme=n.theme,i.size="ax5autocomplete-option-group-"+n.size,i.multiple=n.multiple,i.lang=n.lang,i.options=n.options,this.activecomboboxOptionGroup.find('[data-els="content"]').html(jQuery(ax5.mustache.render(e.tmpl.options.call(this,n.columnKeys),i)))}}.bind(this))};return function(a,c){this.waitOptionsCallback=null;var d,p,r=o.isNumber(a)?a:v.call(this,a),h=this.queue[r],x={};return h.$display.attr("disabled")?this:(this.openTimer&&clearTimeout(this.openTimer),this.activecomboboxOptionGroup?this.activecomboboxQueueIndex==r?this:c>2?this:(this.close(),this.openTimer=setTimeout(function(){this.open(r,(c||0)+1)}.bind(this),t.animateTime),this):(h.optionFocusIndex=-1,h.selected&&h.selected.length>0&&(h.optionSelectedIndex=h.selected[0]["@findex"]),x.id=h.id,x.theme=h.theme,x.size="ax5autocomplete-option-group-"+h.size,x.multiple=h.multiple,x.lang=h.lang,h.$display.attr("data-combobox-option-group-opened","true"),h.onExpand&&(x.waitOptions=!0),x.options=o.filter(h.options,function(){return!this.hide}),this.activecomboboxOptionGroup=jQuery(ax5.mustache.render(e.tmpl.optionGroup.call(this,h.columnKeys),x)),this.activecomboboxOptionGroup.find('[data-els="content"]').html(jQuery(ax5.mustache.render(e.tmpl.options.call(this,h.columnKeys),x))),this.activecomboboxQueueIndex=r,s.call(this,"append"),jQuery(window).bind("resize.ax5autocomplete-"+this.instanceId,function(){s.call(this)}.bind(this)),h.selected&&h.selected.length>0&&(p=this.activecomboboxOptionGroup.find('[data-option-index="'+h.selected[0]["@index"]+'"]'),p.get(0)&&(d=p.position().top-this.activecomboboxOptionGroup.height()/3,this.activecomboboxOptionGroup.find('[data-els="content"]').stop().animate({scrollTop:d},h.animateTime,"swing",function(){}))),jQuery(window).bind("keyup.ax5autocomplete-"+this.instanceId,function(e){e=e||window.event,u.call(this,e),o.stopEvent(e)}.bind(this)),jQuery(window).bind("click.ax5autocomplete-"+this.instanceId,function(e){e=e||window.event,l.call(this,e),o.stopEvent(e)}.bind(this)),n.call(this,h,{self:this,state:"open",item:h}),h.onExpand&&(this.waitOptionsCallback=!0,i.call(this,h)),x=null,d=null,p=null,this))}}(),this.update=function(e){return this.bind(e),this},this.setValue=function(e,t,i){var n=o.isNumber(e)?e:v.call(this,e);if(-1===n)return void console.log(ax5.info.getError("ax5autocomplete","402","val"));if(y.call(this,n),o.isArray(t)){var a=o.map(t,function(){return{value:this}});$.call(this,n,a,i||!0,{noStateChange:!0})}else(o.isString(t)||o.isNumber(t))&&$.call(this,n,{value:t},i||!0,{noStateChange:!0});return r.call(this,n),this},this.setText=function(e,t,i){var n=o.isNumber(e)?e:v.call(this,e);return-1===n?void console.log(ax5.info.getError("ax5autocomplete","402","val")):(y.call(this,n),$.call(this,n,t,!0,{noStateChange:!0}),r.call(this,n),this)},this.getSelectedOption=function(e){var t=o.isNumber(e)?e:v.call(this,e);return-1===t?void console.log(ax5.info.getError("ax5autocomplete","402","val")):o.deepCopy(this.queue[t].selected)},this.close=function(e){return this.closeTimer&&clearTimeout(this.closeTimer),this.activecomboboxOptionGroup?(e=this.queue[this.activecomboboxQueueIndex],e.optionFocusIndex=-1,e.$display.removeAttr("data-combobox-option-group-opened").trigger("focus"),this.activecomboboxOptionGroup.addClass("destroy"),jQuery(window).unbind("resize.ax5autocomplete-"+this.instanceId).unbind("click.ax5autocomplete-"+this.instanceId).unbind("keyup.ax5autocomplete-"+this.instanceId),this.closeTimer=setTimeout(function(){this.activecomboboxOptionGroup&&this.activecomboboxOptionGroup.remove(),this.activecomboboxOptionGroup=null,this.activecomboboxQueueIndex=-1,n.call(this,e,{self:this,state:"close"})}.bind(this),t.animateTime),this.waitOptionsCallback=null,this):this},this.blur=function(e){var t=o.isNumber(e)?e:v.call(this,e);return-1===t?void console.log(ax5.info.getError("ax5autocomplete","402","val")):(r.call(this,t),this)},this.enable=function(e){var t=v.call(this,e);return this.queue[t].$display.removeAttr("disabled"),this.queue[t].$input.removeAttr("disabled"),n.call(this,this.queue[t],{self:this,state:"enable"}),this},this.disable=function(e){var t=v.call(this,e);return this.queue[t].$display.attr("disabled","disabled"),this.queue[t].$input.attr("disabled","disabled"),n.call(this,this.queue[t],{self:this,state:"disable"}),this},this.main=function(){arguments&&o.isObject(arguments[0])?this.setConfig(arguments[0]):this.init()}.apply(this,arguments)};return t}()),e=ax5.ui.autocomplete}(),ax5.ui.autocomplete_instance=new ax5.ui.autocomplete,jQuery.fn.ax5autocomplete=function(){return function(e){if(ax5.util.isString(arguments[0])){var t=arguments[0];switch(t){case"open":return ax5.ui.autocomplete_instance.open(this);case"close":return ax5.ui.autocomplete_instance.close(this);case"setValue":return ax5.ui.autocomplete_instance.setValue(this,arguments[1],arguments[2],arguments[3],arguments[4]||"justSetValue");case"setText":return ax5.ui.autocomplete_instance.setText(this,arguments[1],arguments[2],arguments[3],arguments[4]||"justSetValue");case"getSelectedOption":return ax5.ui.autocomplete_instance.getSelectedOption(this);case"enable":return ax5.ui.autocomplete_instance.enable(this);case"disable":return ax5.ui.autocomplete_instance.disable(this);case"blur":return ax5.ui.autocomplete_instance.blur(this);default:return this}}else"undefined"==typeof e&&(e={}),jQuery.each(this,function(){var t={target:this};e=jQuery.extend({},e,t),ax5.ui.autocomplete_instance.bind(e)});return this}}(),function(){var e=ax5.ui.autocomplete,t=(ax5.util,function(e){return'\n<div class="ax5autocomplete-option-group {{theme}} {{size}}" data-ax5autocomplete-option-group="{{id}}">\n    <div class="ax-combobox-body">\n        <div class="ax-combobox-option-group-content" data-els="content"></div>\n    </div>\n    <div class="ax-combobox-arrow"></div> \n</div>\n'}),o=function(e){return'\n<div class="form-control {{formSize}} ax5autocomplete-display {{theme}}" \ndata-ax5autocomplete-display="{{id}}" data-ax5autocomplete-instance="{{instanceId}}">\n    <div class="ax5autocomplete-display-table" data-els="display-table">\n        <div data-ax5autocomplete-display="label-holder"> \n        <a {{^tabIndex}}href="#ax5autocomplete-{{id}}" {{/tabIndex}}{{#tabIndex}}tabindex="{{tabIndex}}" {{/tabIndex}}\n        data-ax5autocomplete-display="label"\n        contentEditable="true"\n        spellcheck="false">{{{label}}}</a>\n        </div>\n        <div data-ax5autocomplete-display="addon"> \n            {{#multiple}}{{#reset}}\n            <span class="addon-icon-reset" data-selected-clear="true">{{{.}}}</span>\n            {{/reset}}{{/multiple}}\n        </div>\n    </div>\n</a>\n'},i=function(e){return'\n<select tabindex="-1" class="form-control {{formSize}}" name="{{name}}" {{#multiple}}multiple="multiple"{{/multiple}}></select>\n'},n=function(e){return'\n{{#waitOptions}}\n    <div class="ax-combobox-option-item">\n            <div class="ax-combobox-option-item-holder">\n                <span class="ax-combobox-option-item-cell ax-combobox-option-item-label">\n                    {{{lang.loading}}}\n                </span>\n            </div>\n        </div>\n{{/waitOptions}}\n{{^waitOptions}}\n    {{#options}}\n        {{#optgroup}}\n            <div class="ax-combobox-option-group">\n                <div class="ax-combobox-option-item-holder">\n                    <span class="ax-combobox-option-group-label">\n                        {{{.}}}\n                    </span>\n                </div>\n                {{#options}}\n                {{^hide}}\n                <div class="ax-combobox-option-item" data-option-focus-index="{{@findex}}" data-option-group-index="{{@gindex}}" data-option-index="{{@index}}" \n                data-option-value="{{'+e.optionValue+'}}" \n                {{#'+e.optionSelected+'}}data-option-selected="true"{{/'+e.optionSelected+'}}>\n                    <div class="ax-combobox-option-item-holder">\n                        {{#multiple}}\n                        <span class="ax-combobox-option-item-cell ax-combobox-option-item-checkbox">\n                            <span class="item-checkbox-wrap useCheckBox" data-option-checkbox-index="{{@i}}"></span>\n                        </span>\n                        {{/multiple}}\n                        <span class="ax-combobox-option-item-cell ax-combobox-option-item-label">{{'+e.optionText+'}}</span>\n                    </div>\n                </div>\n                {{/hide}}\n                {{/options}}\n            </div>                            \n        {{/optgroup}}\n        {{^optgroup}}\n        {{^hide}}\n        <div class="ax-combobox-option-item" data-option-focus-index="{{@findex}}" data-option-index="{{@index}}" data-option-value="{{'+e.optionValue+'}}" {{#'+e.optionSelected+'}}data-option-selected="true"{{/'+e.optionSelected+'}}>\n            <div class="ax-combobox-option-item-holder">\n                {{#multiple}}\n                <span class="ax-combobox-option-item-cell ax-combobox-option-item-checkbox">\n                    <span class="item-checkbox-wrap useCheckBox" data-option-checkbox-index="{{@i}}"></span>\n                </span>\n                {{/multiple}}\n                <span class="ax-combobox-option-item-cell ax-combobox-option-item-label">{{'+e.optionText+'}}</span>\n            </div>\n        </div>\n        {{/hide}}\n        {{/optgroup}}\n    {{/options}}\n    {{^options}}\n        <div class="ax-combobox-option-item">\n            <div class="ax-combobox-option-item-holder">\n                <span class="ax-combobox-option-item-cell ax-combobox-option-item-label">\n                    {{{lang.noOptions}}}\n                </span>\n            </div>\n        </div>\n    {{/options}}\n{{/waitOptions}}\n'},a=function(e){return'{{#selected}}<div tabindex="-1" data-ax5autocomplete-selected-label="{{@i}}" data-ax5autocomplete-selected-text="{{text}}">\n<div data-ax5autocomplete-remove="true" data-ax5autocomplete-remove-index="{{@i}}">{{{removeIcon}}}</div>\n<span>{{text}}</span>\n</div>{{/selected}}'};e.tmpl={autocompleteDisplay:o,formSelect:i,optionGroup:t,options:n,label:a}}(),function(){var e=ax5.ui.autocomplete,t=(ax5.util,{1:function(e,t,o){var i=this.config,n=t;$(t).find("span").get(0)&&(n=$(t).find("span").get(0));var a,s,l=(n.textContent||n.innerText).replace(/^[\s\r\n\t]*|[\s\r\n\t]*$/g,""),u=this.queue[e];if(u.selected&&u.selected.length>0&&t.getAttribute("data-ax5combobox-selected-text")==l)return a=t.getAttribute("data-ax5combobox-selected-label"),s=u.selected[a],{index:{gindex:s["@gindex"],index:s["@index"],value:s[i.columnKeys.optionValue]}};if(t.getAttribute("data-ax5combobox-selected-text"))return l;if(""!=l){var s;return u.optionFocusIndex>-1&&(s=u.indexedOptions[u.optionFocusIndex])&&s[i.columnKeys.optionText].substr(0,l.length)===l?{index:{gindex:s["@gindex"],index:s["@index"],value:s[i.columnKeys.optionValue]}}:this.queue[e].editable||o?l:void 0}},3:function(e,t,o){var i=(this.config,(t.textContent||t.innerText).replace(/^[\s\r\n\t]*|[\s\r\n\t]*$/g,"")),n=this.queue[e];if(""!=i){var a;return n.optionFocusIndex>-1&&(a=this.activecomboboxOptionGroup.find('[data-option-focus-index="'+n.optionFocusIndex+'"]')),n.optionFocusIndex>-1&&a.get(0)&&a.attr("data-option-value")?{index:{gindex:a.attr("data-option-group-index"),index:a.attr("data-option-index")}}:n.editable||o?i:void 0}}});e.util={nodeTypeProcessor:t}}();